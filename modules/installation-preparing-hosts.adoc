// Module included in the following assemblies:
//
// * installing-byoh/installing-existing-hosts.adoc

[id="installation-preparing-hosts-{context}"]
= Preparing your hosts

Before you install {product-title}, you must prepare the node hosts. Each node
host must meet the following requirements.

.Procedure

. Set the `PATH` for the root user to contain the following directories:

* *_/bin_*
* *_/sbin_*
* *_/usr/bin_*
* *_/usr/sbin_*
+
These directories are set by default in a new RHEL 7.x installation.

. To run the installation program as a non-root user, first configure passwordless
`sudo` rights each host. The {product-title} installer requires a user that has access to all hosts.

.. Generate an SSH key on the host you run the installation playbook on:
+
----
# ssh-keygen
----
+
Do *not* use a password.

.. Distribute the key to the other cluster hosts. You can use a `bash` loop:
+
----
# for host in master.example.com \
    master.example.com \ <1>
    node1.example.com \  <1>
    node2.example.com; \ <1>
    do ssh-copy-id -i ~/.ssh/id_rsa.pub $host; \
    done
----
<1> Provide the host name for each cluster host.

.. Confirm that you can access each host that is listed in the loop through SSH.

. If the *_/etc/environment_* file on your nodes contains either an `http_proxy`
or `https_proxy` value, you must also set a `no_proxy` value in that file to
allow open communication between {product-title} components.
+
[NOTE]
====
The `no_proxy` parameter in *_/etc/environment_* file is not the same value as
the global proxy values that you set in your inventory file. The global proxy
values configure specific {product-title} services with your proxy settings.
====
+
If the *_/etc/environment_* file contains proxy values, define the following
values in the `no_proxy` parameter of that file on each node:

* Master and node host names or their domain suffix.
* Other internal host names or their domain suffix.
* etcd IP addresses. You must provide IP addresses and not host names because *etcd* access is controlled by IP address.
* Kubernetes IP address, by default `172.30.0.1`. Must be the value set in the
`openshift_portal_net` parameter in your inventory file.
* Kubernetes internal domain suffix, `cluster.local`.
* Kubernetes internal domain suffix, `.svc`.
+
[NOTE]
====
Because `no_proxy` does not support CIDR, you can use domain suffixes.
====
+
If you use either an `http_proxy` or `https_proxy` value, your `no_proxy`
parameter value resembles the following example:
+
----
no_proxy=.internal.example.com,10.0.0.1,10.0.0.2,10.0.0.3,.cluster.local,.svc,localhost,127.0.0.1,172.30.0.1
----

. Enable Security-Enhanced Linux (SELinux) and configure
`SELINUX=enforcing` and `SELINUXTYPE=targeted` in the
*_/etc/selinux/config_* file:
+
----
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=enforcing
# SELINUXTYPE= can take one of these three values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected.
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted
----

. Optionally, configure the number of cores you want {product-title}
to use by setting the `GOMAXPROCS` environment variable. By default,
{product-title} masters and nodes use all available cores in the
system they run on. See the
link:https://golang.org/pkg/runtime/#GOMAXPROCS[Go Language documentation] for
more information, including how the `GOMAXPROCS` environment variable works.
+
For example, run the following before starting the server to make
{product-title} only run on one core:
+
----
# export GOMAXPROCS=1
----
+
ifdef::openshift-origin[]
Alternatively, if you plan to
getting_started/administrators.adoc#running-in-a-docker-container[run
OpenShift in a container], add `-e GOMAXPROCS=1` to the `docker run`
command when launching the server.
endif::[]

. Ensure that the required ports are open on your network
and configured to allow access between hosts. The {product-title} installation
automatically creates a set of internal firewall rules on each host using
iptables. However, if your network configuration uses an external firewall, such as a hardware-based
firewall, you must ensure infrastructure components can communicate with each
other through specific ports that act as communication endpoints for certain
processes or services.Some ports are optional depending
on your configuration and usage.
